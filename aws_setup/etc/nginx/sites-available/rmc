server {
  listen       80;
  server_name  uwflow.com;

  # Redirect all HTTP traffic to HTTPS. See
  # https://konklone.com/post/switch-to-https-now-for-free
  return 301 https://$host$request_uri;
}

server {
  listen 443 ssl;
  server_name uwflow.com;

  ssl_certificate /home/rmc/data/ssl/unified.crt;
  ssl_certificate_key /home/rmc/data/ssl/uwflow.com-decrypted.key;

  # TODO(david): See https://gist.github.com/konklone/6532544 for additional
  #     security options.

  gzip on;
  gzip_vary on;
  gzip_proxied any;
  gzip_buffers 16 8k;
  gzip_http_version 1.1;
  gzip_types text/plain text/css application/json application/x-javascript application/javascript text/xml application/xml application/xml+rss text/javascript;

  location / {
    try_files $uri @rmc_app;
  }

  location /static {
    expires 2d;
    add_header Pragma public;
    add_header Cache-Control "public";

    alias /home/rmc/rmc/server/static/;
  }

  location @rmc_app {
    # Don't cache dynamically generated responses from Flask
    expires epoch;
    add_header Cache-Control no-cache;

    include uwsgi_params;
    uwsgi_pass unix:/tmp/uwsgi.sock;
  }
}
