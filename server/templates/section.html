{% import 'macros.html' as macros %}

{% call macros.us_template('sections-collection-tpl') %}
<% _.each(terms, function(term, term_id) { %>
  <h2 class="sections-term-heading"><%- humanizeTermId(term_id) %></h2>
  <table class="sections-table table table-bordered table-rounded">
    <thead>
      <tr>
        <th>Section</th>
        <th>Class</th>
        <th>Campus</th>
        <th>Enrollment</th>
        <th>Waitlist</th>
        <th>Time</th>
        <th>Location</th>
        <th>Instructor(s)</th>
      </tr>
    </thead>
    <tbody>
      <% _.each(term, function(section) { %>
        <tr class="<%- sectionTypeToCssClass(section.get('section_type')) %>">
          <td>
            <%- section.get('section_type') %>
            <%- section.get('section_num') %>
          </td>
          <td>
            <%- section.get('class_num') %>
          </td>
          <td>
            <%- section.get('campus') %>
          </td>
          <td>
            <%- section.get('enrollment_total') %> /
            <%- section.get('enrollment_capacity') %>
          </td>
          <td>
            <%- section.get('waiting_total') %> /
            <%- section.get('waiting_capacity') %>
          </td>
          <td>
            <% _.each(section.get('meetings'), function(meeting) { %>
              <p>
                <% if (meeting.start_time) { %>
                  <%- meeting.start_time %>
                  &ndash;
                  <%- meeting.end_time %>
                  <% if (meeting.days.length) { %>
                    {# TODO(david): This is stupid. Improve. #}
                    <% var days = meeting.days; %>
                    <span class="day-<%- _.contains(days, 'M') %>">M</span
                    ><span class="day-<%- _.contains(days, 'T') %>">T</span
                    ><span class="day-<%- _.contains(days, 'W') %>">W</span
                    ><span class="day-<%- _.contains(days, 'Th') %>">Th</span
                    ><span class="day-<%- _.contains(days, 'F') %>">F</span
                    ><span class="day-<%- _.contains(days, 'S') %>">S</span
                    ><span class="day-<%- _.contains(days, 'Su') %>">Su</span>
                  <% } %>
                <% } %>

                <% if (meeting.start_date) { %>
                  <span class="meeting-dates">
                    <% if (meeting.start_date.$date === meeting.end_date.$date) { %>
                      (<%- moment(meeting.start_date.$date).format('MMM D') %>)
                    <% } else { %>
                      (<%- moment(meeting.start_date.$date).format('MMM D') %>
                      &ndash;
                      <%- moment(meeting.end_date.$date).format('MMM D') %>)
                    <% } %>
                  </span>
                <% } %>
              </p>
            <% }); %>
          </td>
          <td>
            <% _.each(section.get('meetings'), function(meeting) { %>
              <p>
                <% if (meeting.building) { %>
                  <%- meeting.building %>
                  <%- meeting.room %>
                <% } %>
              </p>
            <% }); %>
          </td>
          <td>
            <% _.each(section.get('meetings'), function(meeting) { %>
              <p>
                <% if (meeting.prof_id) { %>
                  <%- humanizeProfId(meeting.prof_id) %>
                <% } %>
              </p>
            <% }); %>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>
<% }); %>
{% endcall %}
