{% extends 'base_page.html' %}

{% import 'macros.html' as macros %}

{% block stylesheets %}
  <link rel="stylesheet" href="{{ '/static/css/onboarding_page.css'|version }}">
{% endblock %}

{% block page_title %}Welcome{% endblock %}

{% block head_scripts %}
<!-- Google Analytics Content Experiment code -->
<script>function utmx_section(){}function utmx(){}(function(){var
k='64363987-2',d=document,l=d.location,c=d.cookie;
if(l.search.indexOf('utm_expid='+k)>0)return;
function f(n){if(c){var i=c.indexOf(n+'=');if(i>-1){var j=c.
indexOf(';',i);return escape(c.substring(i+n.length+1,j<0?c.
length:j))}}}var x=f('__utmx'),xx=f('__utmxx'),h=l.hash;d.write(
'<sc'+'ript src="'+'http'+(l.protocol=='https:'?'s://ssl':
'://www')+'.google-analytics.com/ga_exp.js?'+'utmxkey='+k+
'&utmx='+(x?x:'')+'&utmxx='+(xx?xx:'')+'&utmxtime='+new Date().
valueOf()+(h?'&utmxhash='+escape(h.substr(1)):'')+
'" type="text/javascript" charset="utf-8"><\/sc'+'ript>')})();
</script><script>utmx('url','A/B');</script>
<!-- End of Google Analytics Content Experiment code -->
{% endblock %}

{% block body %}
  <div class="row-fluid">
    <div class="span12" id="onboarding-container">

      <div class="row-fluid {% if friends_transcript_exp %} well {% endif %}">
        <div class="span3">
        <h2>Thanks for signing up!</h2>
          <p class="lead">
            If you could just take a moment to import your course history from
            your Quest transcript, you'll be able to see, rate, and share your
            course history with friends!
          </p>
          <h3>Step 1</h3>
          <p class="step">
            Log in to <a target="_blank"
              href="https://quest.pecs.uwaterloo.ca/psp/SS/?cmd=login">
              Quest</a> &gt; My Academics &gt; Unofficial Transcript
          </p>
          <h3>Step 2</h3>
          <p class="step"> After your transcript loads, select the entire page
            (Ctrl+A) and copy it (Ctrl+C)
          </p>
          <h3>Step 3</h3>
          <p class="step">
            Paste (Ctrl+V) your transcript into the textbox below
            and let the magic happen!
          </p>
        </div>
        <div class="span9" id="laptop-container">
          {# TODO(david): Host video on YouTube #}
          <video id="transcript-video" loop muted controls preload="meta">
            <source src="/static/video/david-transcript-import-640x400.mp4"
              type="video/mp4" />
            <source src="/static/video/david-transcript-import-640x400.webm"
              type="video/webm" />
          </video>
        </div>
      </div>

      <div id="add-transcript-container" class="row-fluid {% if friends_transcript_exp %} well {% endif %}">
      </div>

    </div>
  </div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block templates %}

{% call macros.us_template('add-transcript-tpl') %}

  <% if (pageData.friendsTranscriptExp && !transcript_friends.length) { %>
    <div class="span12">
  <% } else { %>
    <div class="span8">
  <% } %>
    <textarea class="transcript-text"
      placeholder="Feed me a transcript! Mmm... transcripts...."></textarea>
    <div class="transcript-error"></div>

    <% if (pageData.friendsTranscriptExp) { %>
      <p class="transcript-disclaimer">
        <strong style="font-size: 22px">We do not store your grades</strong>.
        Flow only uses your transcript so you can easily <strong>import your
        course history</strong> and share it with friends.
        See our <a href="/privacy">privacy policy</a> for more information.
      </p>
    <% } %>
  </div>

  <% if (pageData.friendsTranscriptExp && transcript_friends.length) { %>
    <div class="span4">
      <div class="friends-added-transcript">
        <h3>
          <%- transcript_friends.length %> <%- pluralize(transcript_friends.length, 'friend') %>
          added their transcript
        </h3>
        <% transcript_friends.each(function(friend) { %>
          <% friend = friend.toJSON(); %>
          <img
            data-title="<%- friend.first_name  %> added <%- friend.course_history.length %> courses"
            rel="tooltip" class="friend-pic" src="<%= friend.fb_pic_url %>">
        <% }); %>
        <p class="mutual-course-text">
          <i class="icon-star"></i> Add your transcript to see mutual courses!
        </p>
      </div>
    </div>
  <% } else if (!pageData.friendsTranscriptExp) { %>
    <div class="span4">
      <h3>We value your privacy</h3>
      <p class="transcript-disclaimer">
        We do not display or store any grades or other private information.
        Flow only uses your transcript so you can easily <strong>import your
          course history</strong> and share it with your friends.
        <strong>Your trust is very important to us, so we take your privacy
          very seriously!</strong> See our <a href="/privacy">privacy
          policy</a> for more information.
      </p>
    </div>
  <% } %>

{% endcall %}

{% endblock %}

{% block scripts %}
<script>
  window.pageData.userObjs = {{ user_objs|tojson|safe }};
  window.pageData.friendsTranscriptExp = {{ friends_transcript_exp|tojson|safe }};
</script>
{% endblock %}
